# üéØ ‡∏ä‡∏∑‡πà‡∏≠ workflow ‡∏ó‡∏µ‡πà‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏ö‡∏ô‡∏´‡∏ô‡πâ‡∏≤ GitHub Actions ‡∏Ç‡∏≠‡∏á repo
name: Playwright Tests

# üöÄ Trigger: ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏°‡∏µ push ‡∏´‡∏£‡∏∑‡∏≠ pull request ‡πÑ‡∏õ‡∏¢‡∏±‡∏á main ‡∏´‡∏£‡∏∑‡∏≠ master
on:
  push:
    branches: [main, master]         # ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏°‡∏µ push ‡πÑ‡∏õ‡∏ó‡∏µ‡πà main ‡∏´‡∏£‡∏∑‡∏≠ master
  pull_request:
    branches: [main, master]         # ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏°‡∏µ PR ‡πÑ‡∏õ‡∏¢‡∏±‡∏á main ‡∏´‡∏£‡∏∑‡∏≠ master

jobs:
  test:
    # üïí ‡∏Å‡∏≥‡∏´‡∏ô‡∏î timeout ‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î‡∏Ç‡∏≠‡∏á job ‡∏ô‡∏µ‡πâ
    timeout-minutes: 60              # ‡∏ñ‡πâ‡∏≤‡πÄ‡∏Å‡∏¥‡∏ô 60 ‡∏ô‡∏≤‡∏ó‡∏µ‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
    runs-on: ubuntu-latest           # ‡πÉ‡∏ä‡πâ runner ‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô Ubuntu ‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ä‡∏±‡∏ô‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î

    steps:
      # ‚úÖ Step 1: Checkout ‡πÇ‡∏Ñ‡πâ‡∏î‡∏à‡∏≤‡∏Å repo
      - uses: actions/checkout@v4    # ‡∏î‡∏∂‡∏á source code ‡∏Ç‡∏≠‡∏á‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Å‡∏ï‡πå‡∏°‡∏≤‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô

      # üîß Step 2: ‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á Node.js LTS version
      - uses: actions/setup-node@v4
        with:
          node-version: lts/*        # ‡πÉ‡∏ä‡πâ Node.js ‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ä‡∏±‡∏ô LTS ‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î

      # üì¶ Step 3: ‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á dependencies ‡∏î‡πâ‡∏ß‡∏¢ npm
      - name: Install dependencies
        run: npm ci                  # ‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡∏à‡∏≤‡∏Å package-lock.json (‡πÄ‡∏£‡πá‡∏ß‡πÅ‡∏•‡∏∞‡πÄ‡∏™‡∏ñ‡∏µ‡∏¢‡∏£)

      # üåê Step 4: ‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á browser engines ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Playwright
      - name: Install Playwright Browsers
        run: npx playwright install --with-deps
        # ‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á Chromium, Firefox, WebKit ‡∏û‡∏£‡πâ‡∏≠‡∏° dependencies ‡∏ó‡∏µ‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô

      # üß™ Step 5: ‡∏£‡∏±‡∏ô Playwright tests
      - name: Run Playwright tests
        run: npx playwright test
        # ‡∏£‡∏±‡∏ô automated UI tests ‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÑ‡∏ß‡πâ‡πÉ‡∏ô‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Å‡∏ï‡πå

      # üì§ Step 6: ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö
      - uses: actions/upload-artifact@v4
        if: ${{ !cancelled() }}      # ‡∏£‡∏±‡∏ô‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÄ‡∏°‡∏∑‡πà‡∏≠ workflow ‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
        with:
          name: playwright-report    # ‡∏ï‡∏±‡πâ‡∏á‡∏ä‡∏∑‡πà‡∏≠ artifact ‡πÄ‡∏õ‡πá‡∏ô "playwright-report"
          path: playwright-report/   # ‡∏£‡∏∞‡∏ö‡∏∏‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î
          retention-days: 30         # ‡πÄ‡∏Å‡πá‡∏ö artifact ‡∏ô‡∏µ‡πâ‡πÑ‡∏ß‡πâ 30 ‡∏ß‡∏±‡∏ô‡∏ö‡∏ô GitHub

      # üßπ Step 6.5: ‡∏•‡∏ö‡πÑ‡∏ü‡∏•‡πå .git ‡∏ó‡∏µ‡πà‡∏≠‡∏≤‡∏à‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô
      - name: Clean GitHub Pages cache
        if: ${{ github.ref == 'refs/heads/main' }}
        run: rm -rf playwright-report/.git

      # üöÄ Step 7: Deploy Playwright report to GitHub Pages
      - name: Deploy report to GitHub Pages
        if: ${{ github.ref == 'refs/heads/main' }}
        uses: peaceiris/actions-gh-pages@v3
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: playwright-report